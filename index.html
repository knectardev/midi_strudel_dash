<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIDI Strudel Interface</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <h1>MIDI Strudel Interface</h1>
    </header>

    <main>
        <section id="controls-global">
            <h2>Global Controls</h2>
            <div class="control-group">
                <label for="globalTonicSelector">Tonic:</label>
                <select id="globalTonicSelector">
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            <div class="control-group">
                <label for="globalScaleSelector">Scale:</label>
                <select id="globalScaleSelector">
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            
            <div class="control-group synth-control-group">
                <label for="synthWaveform">Waveform:</label>
                <select id="synthWaveform">
                    <option value="sine">Sine</option>
                    <option value="square">Square</option>
                    <option value="sawtooth" selected>Sawtooth</option>
                    <option value="triangle">Triangle</option>
                </select>
            </div>
            <div class="control-group synth-control-group">
                <label for="synthDecay">Decay (s):</label>
                <input type="range" id="synthDecay" min="0.01" max="2" step="0.01" value="0.32">
                <span id="synthDecayValue">0.32s</span>
            </div>
            <div class="control-group synth-control-group">
                <label for="synthSustain">Sustain Level:</label>
                <input type="range" id="synthSustain" min="0" max="1" step="0.01" value="0.33">
                <span id="synthSustainValue">0.33</span>
            </div>
            <div class="control-group synth-control-group">
                <label for="synthGain">Gain:</label>
                <input type="range" id="synthGain" min="0" max="1" step="0.01" value="0.36">
                <span id="synthGainValue">0.36</span>
            </div>
            <div class="control-group synth-control-group">
                <label for="synthCutoff">Cutoff (Hz):</label>
                <input type="range" id="synthCutoff" min="20" max="20000" step="1" value="6469">
                <span id="synthCutoffValue">6469Hz</span>
            </div>

            <div id="master-record-control"></div>
            <div id="bpm-control"></div>
            <div id="metronome-control-global"></div>
            <div id="stop-audio-control"></div>
        </section>

        <section id="interactive-elements">
            <div id="xy-pad-section">
                <h2>XY Pad</h2>
                <div id="xyPadContainer"> 
                    <div id="xyPadArea">
                        <div id="xyPadCrosshair"></div>
                    </div>
                    <div id="xyPadInfo">
                        <p>Note: <span id="xyPadNoteDisplay">--</span></p>
                        <p>MIDI: <span id="xyPadMidiDisplay">--</span>, Freq: <span id="xyPadFreqDisplay">-- Hz</span></p>
                        <p>X: <span id="xyPadXDisplay">--</span>, Y: <span id="xyPadYDisplay">--</span> (Velocity)</p>
                    </div>
                </div>
            </div>

           
        </section>

        <section id="coding-elements">
            <div id="strudel-coder-section">
                <h2>Strudel MIDI Coder</h2>
                <div id="strudelCoderContainer" class="component-panel"> 
                    <div class="strudel-coder-header">
                        <select id="strudelDeviceSelector">
                            <option value="all">All Devices</option>
                            <!-- MIDI devices will be populated here -->
                        </select>
                        <button id="strudelClear">Clear</button>
                    </div>
                    <div class="strudel-coder-controls">
                        <div class="notation-toggle">
                            <label for="notationTypeToggle">Notation Type:</label>
                            <select id="notationTypeToggle">
                                <option value="musical">Musical Notation</option>
                                <option value="integer">Integer Notation</option>
                            </select>
                        </div>
                        <div class="sound-selector">
                            <label for="soundTypeInput">Sound:</label>
                            <div class="autocomplete-container">
                                <div class="dropdown-input-wrapper">
                                    <input type="text" id="soundTypeInput" value="piano" placeholder="Type to search sounds..." readonly>
                                    <button type="button" id="soundDropdownToggle" class="dropdown-toggle">â–¼</button>
                                </div>
                                <div id="soundAutocompleteResults" class="autocomplete-results">
                                    <input type="text" id="soundSearchInput" placeholder="Search sounds..." class="search-input">
                                    <div id="soundDropdownOptions" class="dropdown-options"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="strudel-bpm-control">
                        <label for="strudelBpmSlider">BPM (Beats Per Minute):</label>
                        <div class="bpm-control-group">
                            <input type="range" id="strudelBpmSlider" min="10" max="200" value="20" step="1">
                            <span id="strudelBpmValue">20</span>
                        </div>
                    </div>
                    <div class="strudel-quantize-control">
                        <label for="strudelQuantizeSlider">Quantization Resolution (ms):</label>
                        <div class="quantize-control-group">
                            <input type="range" id="strudelQuantizeSlider" min="10" max="1000" value="500" step="25">
                            <span id="strudelQuantizeValue">500ms</span>
                        </div>
                    </div>
                    <div class="strudel-coder-status">
                        <p>Captured Notes: <span id="strudelCapturedNotesCount">0</span></p>
                        <p>Capturing from: <span id="strudelCapturingFromDevice">All Devices</span></p>
                        <p class="hint-text">Code auto-injected into REPL as you play</p>
                    </div>
                </div>
            </div>
        </section>
        

        <section id="strudel-integration-section">
            <div class="strudel-integration-header">
                <h2>Strudel REPL Integration</h2>
                <button id="copyStrudelSyntax">Copy Strudel Syntax</button>
            </div>
            <strudel-editor>
  <!--
setcps(40)
//
// strudel code will go here! 
//
//
-->
            </strudel-editor>
        </section>

        <section id="visual-keyboard-section">
            <h2>Visual Keyboard</h2>
            <div id="pianoKeyboardContainer">
                <!-- Piano keys will be generated by JavaScript -->
            </div>
        </section>


        <section id="status-display">
            <h2>Status</h2>
            <div id="midi-status"><p>MIDI Status: Not Initialized</p></div>
            <div id="audio-status"><p>Audio Status: Not Initialized</p></div>
            <div id="general-status"><p>System Status: Loading...</p></div>
        </section>
    </main>

    <footer>
        <p>Legacy p5.js version can be found in the /legacy folder.</p>
    </footer>

    <script src="js/strudelCoder.js"></script>
    <script src="js/midiHandler.js"></script> 
    <script src="js/xyPad.js"></script>
    <script src="js/audioEngine.js"></script>
    <script src="js/visualKeyboard.js"></script>
    <script src="js/main.js"></script>
    <script src="https://unpkg.com/@strudel/repl@latest"></script>
</body>
</html> 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIDI Strudel Interface</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <h1>MIDI Strudel Interface</h1>
        <a href="https://github.com/knectardev/midi_strudel_dash" target="_blank" class="github-fork-button">
            <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" class="fork-icon">
                <path fill="currentColor" d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"></path>
            </svg>
            Fork on GitHub
        </a>
    </header>

    <main>
        <section id="visual-keyboard-section">
            <div class="keyboard-layout">
                <div id="key-scale-controls-panel" class="component-panel">
                    <h2>Key and Scale Controls</h2>
                    <div class="control-group">
                        <label for="globalTonicSelector">Tonic:</label>
                        <select id="globalTonicSelector">
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="globalScaleSelector">Scale:</label>
                        <select id="globalScaleSelector">
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                    <div id="master-record-control"></div>
                    <div id="bpm-control"></div>
                    <div id="metronome-control-global"></div>
                    <div id="stop-audio-control"></div>
                </div>
                
                <div class="keyboard-and-pad">
                    <div id="pianoKeyboardContainer">
                        <!-- Piano keys will be generated by JavaScript -->
                    </div>
                    <div id="xy-pad-section">
                        <div id="xyPadContainer"> 
                            <div id="xyPadArea">
                                <div id="xyPadCrosshair"></div>
                            </div>
                            <div id="xyPadInfo">
                                <p>Note: <span id="xyPadNoteDisplay">--</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

            <div id="strudel-coder-section">
                <h2>Strudel MIDI Coder</h2>
                <div id="strudelCoderContainer" class="component-panel"> 
                    <div class="strudel-coder-header">
                        <select id="strudelDeviceSelector">
                            <option value="all">All Devices</option>
                            <!-- MIDI devices will be populated here -->
                        </select>
                        <button id="strudelClear">Clear</button>
                    </div>
                    <div class="strudel-coder-controls">
                        <div class="notation-toggle">
                            <label for="notationTypeToggle">Notation Type:</label>
                            <select id="notationTypeToggle">
                                <option value="musical">Musical Notation</option>
                                <option value="integer">Integer Notation</option>
                            </select>
                        </div>
                        <div class="sound-selector">
                            <label for="soundTypeInput">Sound:</label>
                            <div class="autocomplete-container">
                                <div class="dropdown-input-wrapper">
                                    <input type="text" id="soundTypeInput" value="piano" placeholder="Type to search sounds..." readonly>
                                    <button type="button" id="soundDropdownToggle" class="dropdown-toggle">â–¼</button>
                                </div>
                                <div id="soundAutocompleteResults" class="autocomplete-results">
                                    <input type="text" id="soundSearchInput" placeholder="Search sounds..." class="search-input">
                                    <div id="soundDropdownOptions" class="dropdown-options"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="strudel-bpm-control">
                        <label for="strudelBpmSlider">BPM (Beats Per Minute):</label>
                        <div class="bpm-control-group">
                            <input type="range" id="strudelBpmSlider" min="10" max="200" value="20" step="1">
                            <span id="strudelBpmValue">20</span>
                        </div>
                    </div>
                    <div class="strudel-quantize-control">
                        <label for="strudelQuantizeSlider">Quantization Resolution (ms):</label>
                        <div class="quantize-control-group">
                            <input type="range" id="strudelQuantizeSlider" min="10" max="1000" value="500" step="25">
                            <span id="strudelQuantizeValue">500ms</span>
                        </div>
                    </div>
                    <div class="strudel-coder-status">
                        <p>Captured Notes: <span id="strudelCapturedNotesCount">0</span></p>
                        <p>Capturing from: <span id="strudelCapturingFromDevice">All Devices</span></p>
                        <p class="hint-text">Code auto-injected into REPL as you play</p>
                    </div>
                </div>
            </div>

        

        <section id="strudel-integration-section">
            <div class="strudel-integration-header">
                <h2>Strudel REPL Integration</h2>
                <div class="strudel-header-actions">
                    <button id="copyStrudelSyntax">Copy Strudel Syntax</button>
                                         <a href="#" id="strudelDocsLink">
                         <img src="/assets/strudel2.png" alt="Strudel" class="strudel-icon">
                         Load on Strudel.cc
                     </a>
                            </div>
        </div>
        <p class="strudel-controls-hint">press ctrl+enter to play | press ctrl+. to stop</p>
        <strudel-editor>
  <!--
setcps(40)
//
// strudel code will go here! 
//
//
-->
            </strudel-editor>
        </section>



        <section id="status-display">
            <h2>Status</h2>
            <div id="midi-status"><p>MIDI Status: Not Initialized</p></div>
            <div id="audio-status"><p>Audio Status: Not Initialized</p></div>
            <div id="general-status"><p>System Status: Loading...</p></div>
            <div class="midi-controls">
                <button id="refreshMidiDevices">Refresh MIDI Devices</button>
                <button id="logMidiDevices">Log MIDI Devices</button>
            </div>
        </section>
    </main>

    <footer>
        <p>Legacy p5.js version can be found in the /legacy folder.</p>
    </footer>

    <script src="js/strudelCoder.js"></script>
    <script src="js/midiHandler.js"></script> 
    <script src="js/xyPad.js"></script>
    <script src="js/audioEngine.js"></script>
    <script src="js/visualKeyboard.js"></script>
    <script src="js/main.js"></script>
    <script src="https://unpkg.com/@strudel/repl@latest"></script>
</body>
</html> 